<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="./product-data-table.html">

<link rel="stylesheet" href="../../bower_components/bulma/css/bulma.css" type="text/css" media="screen" title="no title" charset="utf-8">
<dom-module id="dashboard-index">

    <template>

        <style>
            :host {
                display: block;
                padding: 10px;
            }

            table {
                margin:2.5%;
            }
            th {
                color: rgba(0, 0, 0, .74);
                @apply(--paper-font-common-base);
                @apply(--paper-font-common-nowrap);
                font-weight: 500;
            }

            th[data-sorted='asc']::after {
                content: "(asc)";
            }

            th[data-sorted='desc']::after {
                content: "(desc)";
            }

            tr {
                height: 48px;
            }
            tr:hover td {
                background: #ddd;
            }
        </style>


        <!-- .columns -->
        <div class="columns">
            <!-- .column -->
            <div class="column is-half">
                <iron-ajax 
                    auto
                    url="/v1/bills?query=balance__gt:0"
                    on-response="_setLastBill"
                    last-response="{{bills}}">
                </iron-ajax>
                <template is="dom-repeat" items="{{bills}}" as="bill">
                    <paper-button style="background:green;color:white;" on-click="_setBill" data-id="{{bill.Id}}">
                        {{bill.Id}}
                    </paper-button>
                </template>
                    <product-data-table url="/v1/sales?query=BillId.Id:{{currentBill}}"
                        bill-id="{{currentBill}}"
                        cols='{"InventoryId.ProductId.Name":"Product Name","Units":"Units","Total":"Cost"}'
                        editable='{"Units"}'
                        id-row="Id"
                        get-url="/v1/sales/:id:/"
                        post-url="/v1/sales/:id:/"
                        delete-url="/v1/sales/:id:/">
                    </product-data-table>
            </div>
        </div>
    </template>

    <script>

        Polymer({

            is: 'dashboard-index',
            properties:{
                currentBill:{
                    type:Number,
                }

            },
            _setLastBill:function(){
                this.currentBill = this.bills[this.bills.length-1];
            },
            _setBill:function(event){
                this.currentBill = event.target.dataId;
            }

        });

    </script>

</dom-module>
